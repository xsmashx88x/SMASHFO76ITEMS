<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMASH'S ROBCO TERMINAL</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">

    <style>
        :root {
            --main-color: #00ff41;
            --dim-color: rgba(0, 255, 65, 0.6);
            --glow-color: rgba(0, 255, 65, 0.25);
            --caps-red: #ff4444;
            --leaders-blue: #44aaff;
            --trade-orange: #ffb347;
        }

        body {
            background-color: #050a05;
            color: var(--main-color);
            font-family: 'VT323', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 0;
            padding: 15px;
            transition: color 0.3s ease;
        }

        .terminal-container {
            max-width: 900px;
            margin: auto;
            border: 2px solid var(--main-color);
            padding: 20px;
            box-shadow: inset 0 0 20px rgba(0, 255, 0, 0.05), 0 0 15px var(--glow-color);
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.02), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.02));
            background-size: 100% 3px, 3px 100%;
        }

        .theme-controls { display: flex; justify-content: flex-end; align-items: center; gap: 10px; margin-bottom: 15px; border-bottom: 1px solid var(--dim-color); padding-bottom: 10px; }
        .color-dot { width: 18px; height: 18px; border: 1px solid #fff; border-radius: 50%; cursor: pointer; }
        #customPicker { background: none; border: 1px solid var(--main-color); width: 25px; height: 25px; cursor: pointer; padding: 0; }

        header { text-align: center; margin-bottom: 25px; }
        header h1 { color: var(--main-color); font-size: 2.2rem; text-shadow: 0 0 8px var(--glow-color); margin:0; }
        
        .button-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; margin-bottom: 25px; }
        button { background: rgba(0, 30, 0, 0.2); color: var(--main-color); border: 1px solid var(--main-color); font-family: 'VT323', monospace; font-size: 1.15rem; padding: 10px 5px; cursor: pointer; transition: 0.2s; }
        button:hover { background: var(--main-color); color: #000; box-shadow: 0 0 12px var(--main-color); }

        .search-area input { width: 100%; background: transparent; border: 1px solid var(--main-color); color: var(--main-color); padding: 12px; font-family: 'VT323', monospace; font-size: 1.5rem; box-sizing: border-box; margin-bottom: 20px; outline: none; }

        .item-row { display: flex; justify-content: space-between; align-items: center; padding: 15px 10px; border-bottom: 1px solid rgba(0,255,0,0.1); cursor: pointer; }
        .item-row:hover { background: rgba(0, 255, 0, 0.1); }
        .item-name { font-size: 1.5rem; color: var(--main-color); font-weight: bold; }
        .item-subtext { font-size: 1.1rem; color: var(--dim-color); white-space: normal; line-height: 1.2; }

        .price-container { text-align: right; display: flex; flex-direction: column; gap: 2px; min-width: 110px; }
        .currency-row { display: flex; justify-content: flex-end; align-items: center; gap: 6px; font-weight: bold; font-size: 1.1rem; }
        
        .caps-text { color: var(--caps-red); }
        .leaders-text { color: var(--leaders-blue); }
        .trade-text { color: var(--trade-orange); }

        .icon-red { filter: invert(15%) sepia(95%) saturate(6932%) hue-rotate(358deg) brightness(95%) contrast(112%); width: 16px; }
        .icon-blue { filter: invert(48%) sepia(79%) saturate(2476%) hue-rotate(180deg) brightness(118%) contrast(119%); width: 16px; }
        .icon-orange { filter: invert(80%) sepia(50%) saturate(1000%) hue-rotate(330deg); width: 16px; }

        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.96); justify-content: center; align-items: center; cursor: pointer; }
        .modal-content { border: 3px solid var(--main-color); padding: 25px; background: #020502; text-align: center; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; position: relative; cursor: default; transition: max-width 0.4s ease; }
        .modal-content.wide { max-width: 95% !important; }

        /* --- CLOSE BUTTON FOR MOBILE --- */
        .close-modal-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff4444;
            color: #000;
            border: none;
            padding: 5px 15px;
            font-family: 'VT323', monospace;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            z-index: 1001;
        }
        .close-modal-btn:hover { background: #fff; }

        #modalImg { display: block; transition: 0.3s; border: 1px solid var(--main-color); margin: 15px auto; }
        .img-small { max-height: 350px; max-width: 100%; cursor: zoom-in; }
        .img-large { max-height: 75vh !important; max-width: 100% !important; cursor: zoom-out !important; }

        #modalDesc { color: var(--dim-color); margin-bottom: 15px; white-space: normal; text-align: center; line-height: 1.4; }

        .info-grid { text-align: left; margin-top: 20px; border-top: 2px solid var(--main-color); padding-top: 15px; display: flex; flex-direction: column; gap: 8px; }
        .info-line { display: flex; justify-content: space-between; border-bottom: 1px solid rgba(0,255,0,0.1); padding: 4px 0; align-items: flex-start; }
        .info-key { color: var(--dim-color); font-weight: bold; padding-right: 10px; }
        .info-value { color: var(--main-color); text-align: right; }

        .alt-view-btn { display: inline-block; color: var(--main-color); text-decoration: none; padding: 10px; border: 1px solid var(--main-color); margin-top: 20px; width: 100%; box-sizing: border-box; }
        .alt-view-btn:hover { background: var(--main-color); color: #000; }

        .modal-pricing-block { margin-top: 15px; border-top: 2px solid var(--main-color); padding-top: 15px; text-align: left; }
        .modal-currency-row { display: flex; align-items: center; justify-content: flex-start; gap: 12px; margin-bottom: 10px; padding: 5px; background: rgba(255, 255, 255, 0.03); }
        .modal-caps { color: #ff4444 !important; font-size: 1.8rem; font-weight: bold; }
        .modal-leaders { color: #44aaff !important; font-size: 1.8rem; font-weight: bold; }
        .modal-trade { color: #ffb347 !important; font-size: 1.8rem; font-weight: bold; }
        .modal-icon { width: 28px !important; height: 28px !important; }

        @media (max-width: 600px) { 
            .button-grid { grid-template-columns: 1fr; } 
            .item-name { font-size: 1.1rem; } 
            .currency-row { font-size: 0.9rem; } 
            .close-modal-btn { width: 100%; position: relative; top: 0; right: 0; margin-bottom: 15px; }
        }
    </style>
</head>
<body>

    <div class="terminal-container">
        <div class="theme-controls">
            <span>TERMINAL COLOR:</span>
            <div class="color-dot" style="background:#00ff41" onclick="changeTheme('#00ff41')"></div>
            <div class="color-dot" style="background:#ffb347" onclick="changeTheme('#ffb347')"></div>
            <div class="color-dot" style="background:#44aaff" onclick="changeTheme('#44aaff')"></div>
            <input type="color" id="customPicker" oninput="changeTheme(this.value)">
        </div>

        <header>
            <h1>SMASH'S ROBCO TERMINAL [v8.2]</h1>
            <p>[ ID: XBOX | xsmashx88x ]</p>
            <p class="header-desc">PRICES ARE NEGOTIABLE. CONTACT VIA XBOX FOR TRADES.</p>
        </header>

        <nav class="button-grid">
            <button id="btn-enclave" onclick="loadData('enclavemods.json')">[ENCLAVE MODS]</button>
            <button id="btn-star" onclick="loadData('starmods.json')">[‚òÖ MODS]</button>
            <button id="btn-fas" onclick="loadData('fasmask.json')">[FAS MASK]</button>
            <button id="btn-plans" onclick="loadData('plans.json')">[PLANS]</button>
            <button id="btn-recipe" onclick="loadData('recipe.json')">[RECIPE]</button>
            <button id="btn-weapons" onclick="loadData('weapons.json')">[WEAPONS]</button>
            <button id="btn-armor" onclick="loadData('armor.json')">[ARMOR]</button>
            <button id="btn-mods" onclick="loadData('mods.json')">[MODS]</button>
            <button id="btn-food" onclick="loadData('fooddrink.json')">[FOOD & DRINK]</button>
            <button id="btn-aid" onclick="loadData('aid.json')">[AID]</button>
            <button id="btn-misc" onclick="loadData('miscjunk.json')">[MISC + JUNK]</button>
            <button id="btn-ammo" onclick="loadData('ammo.json')">[AMMO]</button>
            <button id="btn-apparel" onclick="loadData('apparel.json')">[APPAREL]</button>
        </nav>

        <div class="search-area">
            <input type="text" id="searchInput" placeholder="SEARCH ACTIVE CATEGORY..." onkeyup="filterItems()">
        </div>

        <div id="itemList">
            <div class="item-row" style="justify-content: center; opacity: 0.5;">
                [ SYSTEM READY: PLEASE SELECT A CATEGORY ABOVE ]
            </div>
        </div>
    </div>

    <!-- DETAIL WINDOW -->
    <div id="detailModal" class="modal" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <!-- MOBILE FRIENDLY CLOSE BUTTON -->
            <button class="close-modal-btn" onclick="closeModal()">[X] CLOSE</button>
            
            <h2 id="modalTitle" style="font-size: 2rem; margin: 0;"></h2>
            <div id="modalDesc"></div>
            <img id="modalImg" src="" onclick="toggleImageSize()" class="img-small">
            <div id="modalStats" class="info-grid"></div>
            <div id="modalLinks"></div>
            <p style="margin-top:20px; color:var(--dim-color); font-size:0.8rem;">[ CLICK OUTSIDE OR USE BUTTON TO EXIT ]</p>
        </div>
    </div>

    <script>
        let currentData = [];

        function formatVal(val) {
    // 1. If the value is missing, empty, or literally 0, return a placeholder
    if (val === undefined || val === null || val === "" || val === 0 || val === "0") {
        return "---"; 
    }
    
    // Convert to string and clean it up for checking
    let text = val.toString().toUpperCase().trim();

    // 2. Check for specific Trade keywords
    if (text === "YES" || text === "TRUE") return "‚úÖ YES"; 
    if (text === "NO" || text === "FALSE") return "‚úñ NO";
    if (text === "WTT") return "ü§ù WTT ONLY";

    // 3. If it's a number (like 500), format it with commas
    // We check if it's a number AND doesn't have letters
    if (!isNaN(val) && !/[a-z]/i.test(val)) {
        return Number(val).toLocaleString();
    }

    // 4. Otherwise, just return the text as it is
    return text;
}

        function changeTheme(hex) {
            document.documentElement.style.setProperty('--main-color', hex);
            document.documentElement.style.setProperty('--dim-color', hex + '99'); 
            document.documentElement.style.setProperty('--glow-color', hex + '40');
            document.getElementById('customPicker').value = hex;
            localStorage.setItem('robco_user_color', hex);
        }

        async function loadData(filename) {
            const list = document.getElementById('itemList');
            document.getElementById('searchInput').value = "";
            list.innerHTML = "<div class='item-row'>[ ACCESSING DATABASE... ]</div>";
            try {
                const response = await fetch(filename + "?t=" + Date.now());
                currentData = await response.json();
                renderList(currentData);
            } catch (e) { list.innerHTML = "<div class='item-row' style='color:red'>[ ERROR: FILE NOT FOUND ]</div>"; }
        }

        function renderList(items) {
            const list = document.getElementById('itemList');
            if (!items || items.length === 0) { list.innerHTML = "<div class='item-row'>[ NO DATA ]</div>"; return; }
            list.innerHTML = items.map(item => {
                const idx = currentData.indexOf(item);
                return `
                <div class="item-row" onclick="openDetails(${idx})">
                    <div class="text-container">
                        <div class="item-name">${item.name}</div>
                        <div class="item-subtext">${item.desc || ''}</div>
                    </div>
                    <div class="price-container">
                        <div class="currency-row caps-text">${formatVal(item.caps)} <img src="fo76_caps.png" class="icon-red"></div>
                        <div class="currency-row leaders-text">${formatVal(item.leaders)} <img src="mtg.png" class="icon-blue"></div>
                        <div class="currency-row trade-text">${formatVal(item.trade)} <img src="mtg.png" class="icon-orange"></div>
                    </div>
                </div>`;
            }).join('');
        }

        function openDetails(idx) {
            const item = currentData[idx];
            document.getElementById('modalTitle').innerText = item.name;
            document.getElementById('modalDesc').innerHTML = item.desc || "";
            
            const img = document.getElementById('modalImg');
            img.src = (item.image || 'placeholder.png') + "?t=" + Date.now();
            img.className = 'img-small';

            let statsHTML = `
                <div class="modal-pricing-block">
                    <div class="modal-currency-row">
                        <img src="fo76_caps.png" class="icon-red modal-icon">
                        <span class="modal-caps">${formatVal(item.caps)} CAPS</span>
                    </div>
                    <div class="modal-currency-row">
                        <img src="mtg.png" class="icon-blue modal-icon">
                        <span class="modal-leaders">${formatVal(item.leaders)} LEADERS</span>
                    </div>
                    <div class="modal-currency-row">
                        <img src="mtg.png" class="icon-orange modal-icon">
                        <span class="modal-trade">${formatVal(item.trade)} TRADE</span>
                    </div>
                </div>
            `;

            statsHTML += `<div class="info-grid">`;
            for (const [key, value] of Object.entries(item)) {
                const skip = ['name', 'image', 'desc', 'caps', 'leaders', 'trade', 'alt_view'];
                if (!skip.includes(key.toLowerCase())) {
                    statsHTML += `
                        <div class="info-line">
                            <span class="info-key">${key.toUpperCase()}</span>
                            <span class="info-value">${value}</span>
                        </div>
                    `;
                }
            }
            statsHTML += `</div>`;

            document.getElementById('modalStats').innerHTML = statsHTML;
            document.getElementById('modalLinks').innerHTML = item.alt_view ? 
                `<a href="${item.alt_view}" target="_blank" class="alt-view-btn">[ ACCESS EXTERNAL WIKI DATA ]</a>` : '';

            document.getElementById('detailModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('detailModal').style.display = 'none';
            document.getElementById('modalImg').className = 'img-small';
            document.querySelector('.modal-content').classList.remove('wide');
        }

        function toggleImageSize() {
            const img = document.getElementById('modalImg');
            const box = document.querySelector('.modal-content');
            if (img.classList.contains('img-small')) {
                img.classList.replace('img-small', 'img-large');
                box.classList.add('wide');
            } else {
                img.classList.replace('img-large', 'img-small');
                box.classList.remove('wide');
            }
        }

        function filterItems() {
            const val = document.getElementById('searchInput').value.toLowerCase();
            renderList(currentData.filter(i => i.name.toLowerCase().includes(val) || (i.desc||'').toLowerCase().includes(val)));
        }

        async function updateCounts() {
            const btns = [
                {id:'btn-enclave', f:'enclavemods.json', l:'ENCLAVE MODS'}, {id:'btn-star', f:'starmods.json', l:'‚òÖ MODS'},
                {id:'btn-fas', f:'fasmask.json', l:'FAS MASK'}, {id:'btn-plans', f:'plans.json', l:'PLANS'},
                {id:'btn-recipe', f:'recipe.json', l:'RECIPE'}, {id:'btn-weapons', f:'weapons.json', l:'WEAPONS'},
                {id:'btn-armor', f:'armor.json', l:'ARMOR'}, {id:'btn-mods', f:'mods.json', l:'MODS'},
                {id:'btn-food', f:'fooddrink.json', l:'FOOD & DRINK'}, {id:'btn-aid', f:'aid.json', l:'AID'},
                {id:'btn-misc', f:'miscjunk.json', l:'MISC + JUNK'}, {id:'btn-ammo', f:'ammo.json', l:'AMMO'},
                {id:'btn-apparel', f:'apparel.json', l:'APPAREL'}
            ];
            btns.forEach(async b => {
                try {
                    const r = await fetch(b.f + "?t=" + Date.now());
                    const d = await r.json();
                    const btn = document.getElementById(b.id);
                    if (btn) btn.innerText = `[${b.l}] (${d.length})`;
                } catch(e){}
            });
        }

        window.onclick = (e) => { if (e.target == document.getElementById('detailModal')) closeModal(); }

        window.onload = () => {
            const savedColor = localStorage.getItem('robco_user_color');
            if (savedColor) changeTheme(savedColor);
            updateCounts();
        };
    </script>
</body>
</html>
